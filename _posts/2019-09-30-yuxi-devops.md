---
layout:     post
title:      云栖大会(2019).企业协作与研发效能的解决方案
subtitle:    "\"DevOps\""
date:       2019-09-30
author:     Lin
header-img: img/post-bg-coding0813.jpeg
catalog: true
tags:
    - DevOps
---

## 背景

首先要强调一点，没有银弹，以下都是些大厂、牛人的经验，但经过了千万次的磨炼、实战，值得借鉴。

我参与了3个相关主题会议: 

* 云效DevOps解决方案 *阿里云智能研发效能部资深解决方案架构师 章屹*
* 业务引领的DevOps *国内第一位持续交付布道者 乔梁*
* 小米的研发协作实践 *小米公司技术委员会秘书长 顾大伟*

## 两个主题

下面主要围绕`DevOps`的两个主题，小米主要集中在`OKR`的实践(忽略)。

先贴两个会议的图(大框架):

*面向ISV的研发效能解决方案*

![](https://i.loli.net/2019/09/30/cw3qESDgXaLR2vi.jpg)

*面向双模(传统研发模式&互联网研发模式)的DevOps解决方案*

![](https://i.loli.net/2019/09/30/PLhitxTW51uVY9r.jpg)

会议上聊的内容(干货)很多，我这里抽出ISV个人能力、按需求独立交付两块内容，结合我的理解力，来说说「我们小团队」的版本管理解决方案。

## 团队能力UP

「团队能力」建立在「个人能力」之上，先提下个人能力在研发效能上有哪些方面: 

* 版本管理
* 代码规范
* 环境管理
* 自动化测试

这里，先着重「版本管理」内容，因前端时间一直在梳理这个方面，其他三方面咱们日后再聊。

**我们的问题**

我在咱们小组提出完全按照Git Flow规范来执行「版本管理」，是这样的: 

![](https://i.loli.net/2019/09/30/8lH3eRrFm7DIbn5.jpg)

但遇到一些阻塞，磕磕碰碰的，手动操作很多。

比如:

* 当`feature1`提交`PR`后，合并入了`develop`，开发自测完毕后，拉出`release`提测。因后续测试不顺及其他原因，导致`feature1`发布delay时，`feature2`(本来计划排在`feature1`后面的)需提前，这个时候版本怎么回滚管理？日常中常出现这类场景，如何更好、顺畅的进行？

A: 目前的处理很复杂，需要先将`develop`回滚至上次发版的`tag`，then 进行`feature2`接下来的事情。

* 当`feature1`，合并进了`develop`，同时`release`提测通过了，开始发布流程: PR =》 master，then 提交「预发」回归测试，这里发生了不可抵抗的因素，导致不能麻烦发布「生产环境」。这个时候，`feature2`来了，要一会发布上线；或者需要紧急修复(hotfix)，该怎么顺畅地玩转？

A: 目前的处理也很复杂，需要先将`develop`和`master`回滚至上次发版的`tag`，then 进行`feature2`接下来的事情。

以上应急情况的处理，很考验个人的「git」能力，太复杂就会更容易出岔子。

**双模研发模式**

互联网的研发特点，相比传统研发模式，有`需求散`、`迭代快`、`发版多`。

对于版本管理 提出了不小的挑战，同时国内互联网公司的持续交付管理能力真的都很差(不是我说的，引用乔梁大会上的原话 - 国内的研发管理都是一堆shit)，而咱们小组的交付能力就更别提了:(。

我们细聊下「双模解决方案是什么」，具体解决什么。

双模解决方案就是将「互联网模式」和「传统模式」相结合起来，互联网要快，传统要稳，相结合后 提出「按需求独立迭代/CI」。

互联网往往是微服务架构，需求的大小往往参差不齐。小的，改个小服务的代码搞定；大的，涉及到10个、20个、更多的服务，搞半个月，同时还往往需求与需求之前的服务迭代相互冲突，最后，迭代/发布顺序还随意调整。

而传统公司一般是6个月做一次发版，前期做好大量分析，然后才进行开发，再经过大量测试，然后才会发布。典型的列子就是Windows版本迭代、Microsoft Office版本迭代。

而章屹提出，在阿里云同时采用两种模式 - 双模「按需求独立迭代/CI」，以适应各类需求场景。

通过需求的评估，随时交付/迭代:

* 按天交付
* 按周交付
* 按月交付

**调整后的Git Flow**

我们能套用「双模」吗？我说，试试吧，不试下谁知道。

回顾下，上面提到的`Git Flow`流程，以及流程暴露出来的2个问题(还有更多)，还不能做到双模「按需求独立迭代/CI」。

咱们这里先抛开DevOps、k8s的细节，先来改善下`Git Flow`流程。

结合我的理解力，我做了微调整:

![](https://i.loli.net/2019/09/30/1uwodFlWLvPm8Dk.jpg)

几个改动点:

* 扩大`future分支`范围: 用于开发、自测、提测(测试环境);
* 调整`release分支`职责: 用于预发的回归测试;
* `master分支`: 实时保持与「生产」一致.

问题还是会有，比如预发出现不可抗拒的原因导致发布终止，不过相比之前，流畅度上会改善不少。 -- 记住没有万能的银弹。

## 结尾

以上，我们在整体流程上改善不过是10%或者更少，后续还有更多事情可以提升，大伙一起加油，比如我们可以参与k8s的环境建设。

最后，推荐黄老板(我的上司)的共享PPT「软件交付效能@KodeRover-9月杭州」，很喜欢里面的一句话「研发效能解决的是谁的问题？开发」，就是说，开发是软件交付上的主力军，业务分析、测试不应该是我们的阻碍，而导致迭代受阻，我们为什么不能覆盖这两块作业呢(仅针对小需求)。